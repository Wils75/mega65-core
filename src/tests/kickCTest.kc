import "c64.kc"
import "print"

byte* SCREEN = 0xa000;
byte* button = 0x2000;
byte* COLOUR = 0xd800;

inline void POKE(const unsigned int address, const unsigned char value)
{
  *(unsigned char*) address = value;
}

kickasm(resource "button01.png", pc button, bytes (5 * 5 * 8))
{{
	.var picButton = LoadPicture("button01.png",
															 List().add($000000, $ffffff, $444444, $808080))
	.for(var y = 0; y < 5; y++)
    .for(var x = 0; x < 5; x++)
		  .for(var cp = 0; cp < 8; cp++)
			  .byte picButton.getMulticolorByte(x, cp + y * 8)
}}

void main(void)
{
	// Fast CPU.
	POKE(0x0000, 0x41);

	// Enable access to serial port and other devices.
	POKE(0xd02f, 0x47);
	POKE(0xd02f, 0x53);

	// High resolution in X and Y directions.
	POKE(0xd031, 0x88);
	
	// Move screen to 0xa000.
	POKE(0xd060, 0x00);
	POKE(0xd061, 0xa0);
	
	*BORDERCOL = BLACK;
	*BGCOL = *BGCOL2 = DARK_GREY;
	*BGCOL3 = BLACK;
	*D016 = VIC_MCM | VIC_CSEL;
	
	//memset(SCREEN, BLACK, 40 * 25);
	memset(COLS, WHITE | 8 , 40 * 25);

	unsigned byte n = 0xff;
	unsigned int x, y;

	for(x = 0; x < 45; x++)
	{
		for(y = 0; y < 50; y++)
		{
			SCREEN[x + (y * 45)] = n;
			COLOUR[x + (y * 45)] = 0x00; 
		}
	}
	
	byte ch = 0;
	
	*D018 = toD018(SCREEN, button);

	for(byte y: 0..4)
	{
		for(byte x: 0..4)
		{
			SCREEN[x + (y * 40)] = ch;
			ch++;
			}
	}
	
	while(1)
	{
	}
}
